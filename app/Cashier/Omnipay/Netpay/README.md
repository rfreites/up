
# Omnipay : NetPay

[![Latest Stable Version](https://poser.pugx.org/netpay/omnipay-netpay/v/stable)](https://packagist.org/packages/netpay/omnipay-netpay) 
[![Total Downloads](https://poser.pugx.org/netpay/omnipay-netpay/downloads)](https://packagist.org/packages/netpay/omnipay-netpay) 
[![Latest Unstable Version](https://poser.pugx.org/netpay/omnipay-netpay/v/unstable)](https://packagist.org/packages/netpay/omnipay-netpay) 
[![License](https://poser.pugx.org/netpay/omnipay-netpay/license)](https://packagist.org/packages/netpay/omnipay-netpay)

**Gateway Setup**

Basic Gateway Creation Code
```php
$gateway = Omnipay::create('NetPay_Api');
```

On gateway you can set the following options:

Allows you to test your code in test environment:
```php
$gateway->setTestMode(TRUE);
```

If your endpoint varies from default you can set it using these functions:
```php
$gateway->setLiveEndpoint($liveUrl);
$gateway->setTestEndpoint($testUrl);
```

You can set your merchant credentials using functions:
```php
$gateway->setMerchantId($merchant_id);
$gateway->setUsername($username);
$gateway->setPassword($password);
```

You can set SSL authentication for connection using functions:
```php
$gateway->setCertificatePath($path_to_cert);
$gateway->setCertificateKeyPath($path_to_key);
$gateway->setCertificatePassword($cert_password);
```

**Implemented Gateway Functionalities**

Transactions using card data can be done following way:
```php
$response = $gateway->purchase(array('amount' => '10.00', 'currency' => 'GBP', 'card' => $card))->send();
$response = $gateway->authorize(array('amount' => '10.00', 'currency' => 'GBP', 'card' => $card))->send();
```

You can use following function on any of previous requests to get order id of the payment:
```php
$orderId = $response->getOrderId();
$response = $gateway->capture(array('amount' => '10.00', 'currency' => 'GBP', 'orderId' => $orderId))->send();
$response = $gateway->refund(array('amount' => '10.00', 'currency' => 'GBP', 'orderId' => $orderId))->send();
```

You can use following function on any of previous requests to get transaction id of the payment:
```php
$transactionId = $response->getTransactionId();

$response = $gateway->retrieveTransaction(array('transactionId' => $transactionId, 'orderId' => $orderId))->send();
$response = $gateway->void(array('voidTransactionId' => $transactionId, 'orderId' => $orderId))->send();
```

Transaction id can also be retrieved from capture, refund and void requests.


**For token transactions following can be used:**

When saving card, permanent token expires when card expires and temporary one expires one hour after creation
```php
$response = $gateway->createCard(array('card' => $card, 'tokenPermanent' => TRUE))->send();
```

You can retrieve created token from previous request the following way:
```php
$token = $response->getToken();
```

Deletion of saved card
```php
$response = $gateway->deleteCard(array('token' => $token))->send();
```

Retrieve info about stored card
```php
$response = $gateway->retrieveCard(array('token' => $token))->send();
```

Making transactions using saved tokens
```php
$response = $gateway->purchase(array('amount' => '10.00', 'currency' => 'GBP', 'token' => $token, 'cvv' => $cvv))->send();
$response = $gateway->authorize(array('amount' => '10.00', 'currency' => 'GBP', 'token' => $token, 'cvv' => $cvv))->send();
```

**Following methods can be used on all requests:**

Returns TRUE on successful transaction and FALSE on error
```php
$response->isSuccessful();
```

Returns human readable message if there is one or NULL if not
```php
$response->getMessage();
```

Following functions apply to purchase, authorize, capture, refund, void and retrieveTransaction methods, if data is unavailable they return NULL:

Value as generated by the acquirer that summarizes the success or otherwise of the proposed operation.
```php
$response->getCode();
```

Value generated by the issuing bank in response to a proposal to transfer funds.
```php
$response->getAuthorizationCode();
```

The Reference Retrieval Number (RRN) is a unique number generated by the acquirer for a specific merchant transaction. The RRN can be used to retrieve the transaction data from the acquirer.
```php
$response->getReceipt();
```

Unique Order ID of the successful transaction.
```php
$response->getOrderId();
```

The amount that has been successfully authorized for this order.
```php
$response->getTotalAuthorizedAmount();
```

The amount that has been successfully captured for this order.
```php
$response->getTotalCapturedAmount();
```

The amount that has been successfully refunded for this order.
```php
$response->getRefundedAmount();
```

Summary of the success or otherwise of the proposed operation. List of codes at https://developer.netpay.co.uk/api/transaction/v1#collapseThree?retrieve_transaction_response under response.gateway_code
```php
$response->getGatewayCode();
```

The acquirer CSC response code generated by the card issuing institution
```php
$response->getCSCCode();
```

The card security code result generated to indicate whether the data supplied matches the data held by the cardholder's issuing bank. List of codes at https://developer.netpay.co.uk/api/transaction/v1#collapseThree?retrieve_transaction_response under response.cardsecurity.gateway_code
```php
$response->getCSCGatewayCode();
```

The acquirer AVS response code generated by the card issuing institution.
```php
$response->getAVSCode();
```

The address verification result generated to indicate whether the address data supplied matches the data held by the cardholder's issuing bank.  List of codes at https://developer.netpay.co.uk/api/transaction/v1#collapseThree?retrieve_transaction_response under response.cardholder_verification.avs_gateway_code
```php
$response->getAVSGatewayCode();
```